"use strict";(self.webpackChunk_enactive_ac_management_ui=self.webpackChunk_enactive_ac_management_ui||[]).push([[9551],{39551:function(e,t,n){n.r(t),n.d(t,{default:function(){return on}});var i=n(30969),r=n(80867),o=n(27209),a=n(86822),s=n(19065),c=n(10684),l=n(38890),u=n(62221),d=n(59802),h=n(75260),p=n(98807),v=n(73376),f=n(42166),m=n(78530),x=n(6818),g=n(26385),Z=n(60325),j=n(30734);function b(e,t,n){var r=(0,i.useState)(n),o=(0,s.Z)(r,2),a=o[0],c=o[1],l=(0,i.useCallback)(e,t);return(0,i.useEffect)((function(){var e=l();if(void 0!==e){var t=e.subscribe(c);return function(){return t.unsubscribe()}}}),[l]),[a]}var y=n(82333),w=n(85358),C=n(57994),S=n(98907),k=n(98226),P=n(43310),$=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.Z.create({baseURL:"".concat(null!==(t=new URLSearchParams(window.location.search.slice(1)).get("_devHost"))&&void 0!==t?t:"https://api.".concat(window.location.hostname.replace("www.","")),"/api/"),withCredentials:!0});(0,C.Z)(this,e),this.axios=n,this.me$$=new P.X(void 0),this.sites$$=new P.X(void 0),this.tours$$=new P.X(void 0),this.me$=this.me$$.asObservable(),this.sites$=this.sites$$.asObservable(),this.tours$=this.tours$$.asObservable()}return(0,S.Z)(e,[{key:"init",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(){var t,n;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.me$$.value,e.next=3,this.getMe().catch((function(){return null}));case 3:if(n=e.sent,(null===t||void 0===t?void 0:t.id)===(null===n||void 0===n?void 0:n.id)){e.next=11;break}if(null!==n){e.next=9;break}this.sites$$.next(void 0),e.next=11;break;case 9:return e.next=11,this.loadSites();case 11:this.me$$.next(n);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMe",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/me");case 2:return e.abrupt("return",e.sent.data.me);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signUp",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t){var n,i;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={account:{email:t,id:""}},e.next=3,this.axios.post("management/signup",n);case 3:return i=e.sent,this.me$$.next({displayName:i.data.account.email,id:i.data.account.id,isExternal:!1}),e.abrupt("return",i.data.account);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,n){var i;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/login",{code:n,id:t});case 2:return i=e.sent,e.t0=this.me$$,e.next=6,this.getMe();case 6:return e.t1=e.sent,e.t0.next.call(e.t0,e.t1),e.next=10,this.loadSites();case 10:return e.abrupt("return",i.data.account);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/logout");case 2:this.tours$$.next(void 0),this.sites$$.next(void 0),this.me$$.next(void 0),window.location.reload();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateSite",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,n){var i,r;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.put("management/sites/".concat(t),n);case 2:return r=e.sent,this.sites$$.next(null===(i=this.sites$$.value)||void 0===i?void 0:i.map((function(e){return e.id===t?r.data.site:e}))),e.abrupt("return",r.data.site);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadTours",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t){var n;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/sites/".concat(t,"/tours"));case 2:return n=e.sent,this.tours$$.next(n.data.tours),e.abrupt("return",n.data.tours);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTour",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,n){var i,r,o;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/sites/".concat(t,"/tours"),n);case 2:return i=e.sent,r=i.data.tour,o=this.tours$$.value,this.tours$$.next(void 0===o?[r]:o.concat([r])),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTour",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,n,i){var r,o,a;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.put("management/sites/".concat(t,"/tours/").concat(n),i);case 2:return r=e.sent,o=r.data.tour,a=this.tours$$.value,this.tours$$.next(void 0===a?[o]:a.map((function(e){return e.id===o.id?o:e}))),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"deleteTour",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,n){var i;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.delete("management/sites/".concat(t,"/tours/").concat(n));case 2:e.sent.status<300&&this.tours$$.next(null===(i=this.tours$$.value)||void 0===i?void 0:i.filter((function(e){return e.id!==n})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadSites",value:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(){var t;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/sites");case 2:return t=e.sent,this.sites$$.next(t.data.sites),e.abrupt("return",t.data.sites);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),E=n(95764),I=n(69628),T=n(5356),F=n(71127),A=n(66060),O=n(21829),M=n(37574),N=function(e){var t=e.me,n=e.buttonProps,r=e.onSignOut,o=(0,i.useRef)(null),a=(0,i.useState)(!1),c=(0,s.Z)(a,2),l=c[0],u=c[1];return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.Z,(0,E.Z)((0,E.Z)({color:"inherit"},n),{},{ref:o,onClick:function(e){var t;u(!0),null===n||void 0===n||null===(t=n.onClick)||void 0===t||t.call(n,e)},children:t.displayName})),(0,M.jsx)(I.Z,{anchorEl:o.current,disablePortal:!0,open:l,children:(0,M.jsx)(T.Z,{children:(0,M.jsx)(F.Z,{onClickAway:function(){return u(!1)},children:(0,M.jsx)(A.Z,{children:(0,M.jsx)(O.Z,{children:(0,M.jsx)(x.Z,{onClick:function(){return r()},children:"Sign Out"})})})})})})]})},U=n(81034),D=n(72103),R=n(6719),W=n(76025),z=n.n(W),q=n(97777);q.addMethod(q.string,"validRegex",(function(){return this.test("test-valid-regex",(function(e){if(void 0===e)return!0;var t=this.path,n=this.createError;try{return new RegExp(e),!0}catch(i){return i instanceof Error?n({message:i.message,path:t}):n({message:i,path:t})}}))})),q.addMethod(q.string,"validCssSelector",(function(){return this.test("test-valid-css-selector",(function(e){if(void 0===e||""===e)return!0;var t=this.path,n=this.createError;try{return document.querySelector(e),!0}catch(i){return n({message:"Invalid CSS selector",path:t})}}))})),q.addMethod(q.string,"validJsonPathFilter",(function(){return this.test("test-valid-jsonp-path-filter",(function(e){if(void 0===e||""===e)return!0;var t=this.path,n=this.createError;try{return z().query([],"$[?(".concat(e,")]")),!0}catch(i){return n({message:"Invalid JSON Path filter",path:t})}}))})),q.addMethod(q.string,"validXpathSelector",(function(){return this.test("test-valid-xpath-selector",(function(e){if(void 0===e||""===e)return!0;var t=this.path,n=this.createError;try{return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),!0}catch(i){return n({message:"Invalid XPath selector",path:t})}}))})),q.addMethod(q.string,"validNonEmptyHtml",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.empty,n=void 0===t?"Please enter some text":t,i=e.invalid,r=void 0===i?function(e){return"Invalid HTML".concat(void 0!==e?": ".concat(e.message):"")}:i;return this.test("test-valid-non-empty-html",(function(e){var t=this.path,i=this.createError;if(void 0===e)return i({message:n,path:t});try{var o,a,s;return""!==(null!==(o=null===(a=(new DOMParser).parseFromString(e,"text/html"))||void 0===a||null===(s=a.body.textContent)||void 0===s?void 0:s.trim())&&void 0!==o?o:"")||i({message:n,path:t})}catch(c){return i({message:r(c instanceof Error?c:void 0),path:t})}}))}));var H=q,_=["disabled","key"],V=function(e){var t=e.disabled,n=void 0!==t&&t,r=e.key,o=(0,U.Z)(e,_),a=(0,i.useMemo)((function(){return void 0!==r&&null!==r||n?void 0===r||null===r?"disabled":n?"".concat(r,"-disabled"):r:void 0}),[n,r]);return(0,i.createElement)(x.Z,(0,E.Z)((0,E.Z)({},o),{},{key:a,disabled:n}))},L=n(34508),J=n(84404),B=n(72827),X=n(96919),G=n(17281),Y=(0,u.ZP)(J.Z)((function(e){return{alignItems:"center",display:"flex",justifyContent:"space-between",marginBottom:e.theme.spacing(4)}})),K=(0,u.ZP)(B.Z)({padding:"3em"}),Q=(0,u.ZP)(X.Z)((function(e){var t=e.theme;return{backgroundColor:t.palette.grey[50],borderTop:"solid 1px",borderTopColor:t.palette.grey[200],padding:t.spacing(4)}})),ee=function(e){var t=e.actions,n=e.children,i=e.onClose,r=e.onExited,o=e.open,a=e.title,s=e.width,c=void 0===s?"35rem":s;return(0,M.jsxs)(G.ZP,{SlideProps:{onExited:r},anchor:"right",disableEnforceFocus:!0,onClose:i,open:o,children:[(0,M.jsxs)(Y,{children:[(0,M.jsx)(p.Z,{component:"span",style:{flexGrow:1},variant:"h5",children:a}),void 0!==i?(0,M.jsx)(g.Z,{onClick:i,children:(0,M.jsx)(L.Z,{})}):void 0]}),(0,M.jsx)(K,{sx:{width:c},children:n}),(0,M.jsx)(Q,{children:t})]})},te=["alignItems","col"],ne=["grow"],ie=function(e){var t=e.alignItems,n=void 0===t?"center":t,i=e.col,r=void 0!==i&&i,o=(0,U.Z)(e,te);return(0,M.jsx)(h.Z,(0,E.Z)((0,E.Z)({},o),{},{alignItems:n,sx:(0,E.Z)((0,E.Z)({},o.sx),{},{display:"flex",flexDirection:r?"column":"row"})}))},re=function(e){var t=e.grow,n=void 0!==t&&t,i=(0,U.Z)(e,ne);return(0,M.jsx)(h.Z,(0,E.Z)((0,E.Z)({},i),{},{sx:(0,E.Z)((0,E.Z)({},i.sx),{},{flexGrow:n?1:void 0})}))},oe=["value"],ae=H.object().shape({primaryColor:H.string().required().matches(/^#([a-f0-9]{3}|[a-f0-9]{6})$/i,{message:"Please specify a valid hex colour (e.g., #4f4f4f)"}),primaryContrastText:H.string().required().matches(/^#([a-f0-9]{3}|[a-f0-9]{6})$/i,{message:"Please specify a valid hex colour (e.g., #FFF)"})}),se=function(e){var t=e.value,n=(0,U.Z)(e,oe);return(0,M.jsxs)(ie,{children:[(0,M.jsx)(h.Z,{alignSelf:"flex-start",border:"solid 1px #eee",borderRadius:"0.25rem",height:"3rem",mr:1,mt:.5,sx:{backgroundColor:t},width:"3.3rem"}),(0,M.jsx)(D.gN,(0,E.Z)((0,E.Z)({size:"medium",variant:"outlined"},n),{},{component:R.n}))]})},ce=function(e){var t,n=e.managementService,r=e.onClose,o=e.onExited,a=e.onSave,s=e.open,c=e.site,l=(0,v.Z)(),u=(0,i.useRef)(null);return(0,M.jsx)(ee,{actions:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(V,{onClick:function(){return r()},size:"large",children:"Cancel"}),(0,M.jsx)(V,{onClick:function(){var e;return null===(e=u.current)||void 0===e?void 0:e.submitForm()},size:"large",variant:"contained",children:"Save"})]}),onClose:r,onExited:o,open:s,title:"Edit theme",children:(0,M.jsx)(D.J9,{initialValues:null!==(t=c.theme)&&void 0!==t?t:{primaryColor:"#4f4f4f",primaryContrastText:"#fff"},innerRef:u,onSubmit:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t,i){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.setSubmitting(!0),e.next=3,n.updateSite(c.id,{site:(0,E.Z)((0,E.Z)({},c),{},{theme:t})});case 3:i.setSubmitting(!1),a(t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validationSchema:ae,children:function(e){return(0,M.jsxs)(D.l0,{children:[(0,M.jsx)(h.Z,{my:2,children:(0,M.jsx)(se,{fullWidth:!0,helperText:"Used for primary button background. This is usually your primary brand color.",label:"Primary color",name:"primaryColor",placeholder:l.palette.primary.main,value:e.values.primaryColor})}),(0,M.jsx)(h.Z,{my:2,children:(0,M.jsx)(se,{fullWidth:!0,helperText:"Text color that is displayed on top of your primary color.",label:"Primary contrast text",name:"primaryContrastText",placeholder:l.palette.primary.contrastText,value:e.values.primaryContrastText})})]})}})})},le=n(73165),ue=n(21160),de=n(42420),he=n(97610),pe=n(73939),ve=n(82801),fe=n(94927),me=n(82465),xe=n(92406),ge=n(5369),Ze=n(70673),je=n(46607),be=n(93589),ye=["code","language"],we=(0,u.ZP)(h.Z)((function(e){var t=e.theme;return{"& button":{right:0,top:0},border:"solid 1px #eaeafa",borderRadius:t.spacing(1),padding:t.spacing(1)}})),Ce=function(e){var t=e.code,n=e.language,i=(0,U.Z)(e,ye);return(0,M.jsx)(we,(0,E.Z)((0,E.Z)({},i),{},{children:(0,M.jsx)(be.Z1,{language:n,text:t,theme:be.E7})}))},Se=["children"],ke=(0,u.ZP)(ue.Z)({textAlign:"center"}),Pe=function(e){var t=e.children,n=(0,U.Z)(e,Se);return(0,M.jsx)(ue.Z,(0,E.Z)((0,E.Z)({},n),{},{children:(0,M.jsx)("code",{children:t})}))},$e=(0,u.ZP)(Pe)({textAlign:"center"}),Ee=function(e){var t=e.attrName,n=e.attrType,i=e.children,r=e.defaultValue,o=void 0===r?"":r,a=e.example,s=e.required,c=void 0!==s&&s;return(0,M.jsxs)(de.Z,{children:[(0,M.jsx)(ke,{children:(0,M.jsx)(he.Z,{title:c?"Required attribute":"Optional attribute",children:c?(0,M.jsx)(pe.Z,{badgeContent:"R",color:"error"}):(0,M.jsx)(pe.Z,{badgeContent:"O",color:"info"})})}),(0,M.jsx)(Pe,{children:t}),(0,M.jsx)($e,{children:n}),(0,M.jsx)(ue.Z,{children:o}),(0,M.jsxs)(ue.Z,{children:[i,void 0!==a?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(p.Z,{my:1,variant:"subtitle2",children:"Example:"}),(0,M.jsx)("code",{children:a})]}):void 0]})]})},Ie=function(){var e=(0,j.UO)().siteId;return void 0!==e?(0,M.jsxs)(h.Z,{maxWidth:"md",mx:"auto",my:2,width:"100%",children:[(0,M.jsx)(p.Z,{component:"h2",variant:"h5",children:"Installation"}),(0,M.jsx)("p",{children:"To enable Enactive Tours you must place a script into all webpages on which you want tours to run. Usually you will put this in a site template or use Google Tag Manager so it applies to all pages, and then you can control which URL each tour runs on in the tour configuration."}),(0,M.jsx)("p",{children:"In its simplest form, the script looks like this:"}),(0,M.jsx)(Ce,{code:Te('\n              |<script\n              |  defer\n              |  enactive.site-id="'.concat(e,'"\n              |  src="https://www.enactive.ac/integration/entrypoint.js"\n              |><\/script>\n            ')),language:"html",mx:"auto",my:2}),(0,M.jsx)("p",{children:"Please refer to the following examples for various methods of putting Enactive Tours on your site."}),(0,M.jsxs)(ve.Z,{children:[(0,M.jsx)(fe.Z,{expandIcon:(0,M.jsx)(le.Z,{}),children:(0,M.jsx)(p.Z,{component:"h2",variant:"h6",children:"JavaScript"})}),(0,M.jsxs)(me.Z,{children:["Copy and paste the following block of HTML and JavaScript code to the end of the ",(0,M.jsx)("code",{children:"<body>"})," tag of your website.",(0,M.jsx)(Ce,{code:Te("\n              |<script>\n              |  const script = document.createElement('script');\n              |  script.src = 'https://www.enactive.ac/integration/entrypoint.js';\n              |  script.setAttribute('enactive.site-id', '".concat(e,"');\n              |\n              |  // If there is a user signed in to your website, add their User ID\n              |  script.setAttribute('enactive.context.user.id', '{the user id}');\n              |  document.body.appendChild(script);\n              |<\/script>\n            ")),language:"javascript",mx:"auto",my:2})]})]}),(0,M.jsxs)(ve.Z,{children:[(0,M.jsx)(fe.Z,{expandIcon:(0,M.jsx)(le.Z,{}),children:(0,M.jsx)(p.Z,{component:"h2",variant:"h6",children:"HTML"})}),(0,M.jsxs)(me.Z,{children:[(0,M.jsx)(h.Z,{mb:1,children:(0,M.jsxs)(xe.Z,{severity:"info",children:["The HTML example on its own is only suitable for displaying tours to anonymous users. To improve our ability to remember user preferences, you must add a"," ",(0,M.jsxs)("code",{children:['enactive.context.user.id="',"{the user id}",'"']})," ","attribute to the script tag either in server-side rendering or with JavaScript."]})}),"Copy and paste the following block of HTML code to the end of the"," ",(0,M.jsx)("code",{children:"<body>"})," tag of your website.",(0,M.jsx)(Ce,{code:Te('\n              |<script \n              |  defer\n              |  enactive.site-id="'.concat(e,'"\n              |  src="https://www.enactive.ac/integration/entrypoint.js"\n              |><\/script>\n            ')),language:"html",mx:"auto",my:2})]})]}),(0,M.jsx)(p.Z,{component:"h2",mt:4,variant:"h5",children:"Script API"}),(0,M.jsx)("p",{children:"You can specify various metadata attributes on your script tag to control how Enactive works. Please refer to the following list for all metadata attributes that are available."}),(0,M.jsxs)(ge.Z,{children:[(0,M.jsx)(Ze.Z,{children:(0,M.jsxs)(de.Z,{children:[(0,M.jsx)(ue.Z,{}),(0,M.jsx)(ue.Z,{children:"Attribute"}),(0,M.jsx)(ke,{children:"Type"}),(0,M.jsx)(ke,{children:"Default"}),(0,M.jsx)(ue.Z,{children:"Description"})]})}),(0,M.jsxs)(je.Z,{children:[(0,M.jsxs)(Ee,{attrName:"enactive.site-id",attrType:"string",example:'enactive.site-id="'.concat(e,'"'),required:!0,children:["Your Enactive Site ID: ",(0,M.jsx)("code",{children:e})]}),(0,M.jsxs)(Ee,{attrName:"enactive.enabled",attrType:"boolean",defaultValue:"true",example:'enactive.enabled="false"',children:["If set to ",(0,M.jsx)("code",{children:"false"})," then all functionality will be deactivated."]}),(0,M.jsx)(Ee,{attrName:"enactive.context.user.id",attrType:"string",defaultValue:"{random}",example:'enactive.context.user.id="155987"',children:'Specify a User ID if a user is signed in to your website. This ensures that when a user "dismisses" a tour, they are not shown the tour again when switching devices.'}),(0,M.jsx)(Ee,{attrName:"enactive.context.user.locale",attrType:"string",defaultValue:"{derived}",example:'enactive.context.user.locale="fr-fr"',children:"Specify a locale if a user is signed in to your website and has their own language preference. If unspecified, a preference is derived from the page language and the user's browser."})]})]})]}):(0,M.jsx)(M.Fragment,{})};function Te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.end,i=void 0===n?/\s+$/:n,r=t.start,o=void 0===r?/^\s*\|/g:r;return e.trim().split("\n").map((function(e){return e.replace(o,"").replace(i,"")})).join("\n")}var Fe=n(17014),Ae=(0,u.ZP)(d.Z)({alignItems:"center",display:"flex",flexGrow:1,justifyContent:"center",width:"100%"}),Oe=n(90045),Me=H.object().shape({code:H.string().required("A 6-digit code is required").matches(/[0-9]{6}/,{message:"A valid 6-digit code is required"})}),Ne=(0,u.ZP)(h.Z)((function(e){return{marginTop:e.theme.spacing(2),textAlign:"right"}})),Ue=function(e){var t=e.account,n=e.managementService,i=e.onCancel,r=e.onSignIn,o=void 0===r?function(){}:r;return(0,M.jsx)(D.J9,{initialValues:{code:""},onSubmit:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(i,r){var a;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t){e.next=7;break}return r.setSubmitting(!0),e.next=4,n.login(t.id,i.code);case 4:a=e.sent,r.setSubmitting(!1),o(a);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validationSchema:Me,children:function(e){return(0,M.jsxs)(D.l0,{children:[(0,M.jsx)(D.gN,{component:R.n,fullWidth:!0,helperText:"Check your email and copy your 6 digit sign-in code into this field.",label:"Sign-in code",name:"code"}),(0,M.jsx)(Ne,{children:(0,M.jsxs)(Oe.Z,{children:[(0,M.jsx)(V,{onClick:i,size:"large",children:"Cancel"}),(0,M.jsx)(V,{onClick:function(){return e.submitForm()},size:"large",variant:"contained",children:"Sign In"})]})})]})}})},De=n(38557),Re=H.object().shape({email:H.string().required("Email address is required").email("Invalid email address")}),We=(0,u.ZP)(h.Z)((function(e){return{marginTop:e.theme.spacing(2),textAlign:"right"}})),ze=function(e){var t=e.managementService,n=e.onSignUp;return(0,M.jsx)(D.J9,{initialValues:{email:""},onSubmit:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(i,r){var o;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setSubmitting(!0),e.next=3,t.signUp(i.email);case 3:o=e.sent,r.setSubmitting(!1),n(o);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validationSchema:Re,children:function(e){return(0,M.jsxs)(D.l0,{children:[(0,M.jsx)(D.gN,{component:R.n,fullWidth:!0,helperText:"We'll send you a sign-in code to this email address.",label:"Email address",name:"email"}),(0,M.jsx)(We,{children:(0,M.jsx)(Oe.Z,{children:(0,M.jsx)(V,{endIcon:(0,M.jsx)(De.Z,{}),onClick:function(){return e.submitForm()},size:"large",variant:"contained",children:"Next"})})})]})}})},qe=function(e){var t=e.managementService,n=e.onSignIn,r=(0,i.useState)(!1),o=(0,s.Z)(r,2),a=o[0],c=o[1],l=(0,i.useState)(),u=(0,s.Z)(l,2),d=u[0],p=u[1],v=b((function(){return t.sites$}),[t]),f=(0,s.Z)(v,1)[0];return(0,M.jsxs)(Ae,{children:[(0,M.jsx)(Fe.Z,{direction:a?"right":"left",in:void 0===d,onEntered:function(){c(!0),He()},unmountOnExit:!0,children:(0,M.jsx)(h.Z,{position:"absolute",width:1/4,children:(0,M.jsx)(ze,{managementService:t,onSignUp:p})})}),(0,M.jsx)(Fe.Z,{direction:void 0===f?"left":"right",in:void 0!==d&&void 0===f,onEntered:function(){return He()},onExited:function(){void 0!==d&&void 0!==f&&n()},unmountOnExit:!0,children:(0,M.jsx)(h.Z,{position:"absolute",width:1/4,children:(0,M.jsx)(Ue,{account:d,managementService:t,onCancel:function(){return p(void 0)}})})})]})};function He(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"input[name]";null===(e=document.querySelector(n))||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}var _e=n(2669),Ve=n(98231),Le=n(63593),Je=n(27771),Be=n(1089),Xe=n(36600),Ge=n(62519),Ye=n(16798),Ke=n(96799),Qe=n(73836),et=n(30308),tt=n(8976),nt=n(48533),it=n(22207),rt=n(9291),ot=n(49754),at=n(20303),st=n(27397),ct=n(59019),lt={"course.role.instructor":{label:{badge:"User",description:"Is instructor in course"}},"course.role.student":{label:{badge:"User",description:"Is student in course"}},"page.id.course.calendar":{label:{badge:"Page",description:"Course calendar"}},"page.id.course.engagement":{label:{badge:"Page",description:"Course discussion"}},"page.id.course.grades":{label:{badge:"Page",description:"Course gradebook"}},"page.id.course.outline":{label:{badge:"Page",description:"Course outline"}},"page.id.stream":{label:{badge:"Page",description:"Activity stream"}},"user.anonymous.false":{label:{badge:"User",description:"Is logged in"}},"user.anonymous.true":{label:{badge:"User",description:"Is not logged in"}},"user.role.faculty":{label:{badge:"User",description:"Is primarily institution faculty"}},"user.role.student":{label:{badge:"User",description:"Is primarily institution student"}}},ut={ultra:{conditions:[].concat((0,ct.Z)(["stream","course.outline","course.calendar","course.engagement","course.grades"].map((function(e){return(0,E.Z)({applicable:function(e){return void 0===e.conditions.find((function(e){return e.id.startsWith("page.")}))},color:"#0002A1",expr:'@.context.page.id=="'.concat(e,'"'),id:"page.id.".concat(e)},lt["page.id.".concat(e)])}))),(0,ct.Z)(["false","true"].map((function(e){return(0,E.Z)({applicable:function(e){return void 0===e.conditions.find((function(e){var t=e.id;return t.startsWith("course.role.")||t.startsWith("user.anonymous.")}))},color:"#D23369",expr:"".concat("false"===e?"!":"","@.context.user.anonymous"),id:"user.anonymous.".concat(e)},lt["user.anonymous.".concat(e)])}))),(0,ct.Z)(["faculty","student"].map((function(e){return(0,E.Z)({applicable:function(e){return void 0===e.conditions.find((function(e){return e.id.startsWith("user.anonymous.true")}))},color:"#D23369",expr:'@.context.user.role=="'.concat(e,'"'),id:"user.role.".concat(e)},lt["user.role.".concat(e)])}))),(0,ct.Z)(["instructor","student"].map((function(e){return(0,E.Z)({applicable:function(e){return void 0===e.conditions.find((function(e){var t=e.id;return t.startsWith("course.role.")||t.startsWith("user.anonymous.true")}))},color:"#D23369",expr:'@.context.course.role=="'.concat(e,'"'),id:"course.role.".concat(e)},lt["course.role.".concat(e)])}))),[{color:"#3F0071",expr:"@.context.course.content.has",id:"course.state.content.has",label:{badge:"Course",description:"Has content"}},{color:"#3F0071",expr:"@.context.course.announcements.has",id:"course.state.announcements.has",label:{badge:"Course",description:"Has announcement"}},{color:"#3F0071",expr:'@.activity.course.has("course.calendar.addEvent")',id:"activity.course.has.createCourseEvent",label:{badge:"Course Activity",description:"Has created calendar event"}},{color:"#3F0071",expr:'@.activity.course.has("course.calendar.addOfficeHours")',id:"activity.course.has.addOfficeHours",label:{badge:"Course Activity",description:"Has added office hours"}},{color:"#3F0071",expr:'@.activity.course.has("components.directives.messages.courseConversation.sendMessage.button")',id:"activity.course.has.sendCourseMessage",label:{badge:"Course Activity",description:"Has sent a message"}},{color:"#D23369",expr:'@.activity.user.has("components.directives.add-content-button.contextualMenu.menuItem")',id:"activity.user.has.createCourseContent",label:{badge:"User Activity",description:"Has created course content"}},{color:"#D23369",expr:'@.activity.user.has("course.calendar.addEvent")',id:"activity.user.has.createCourseEvent",label:{badge:"User Activity",description:"Has created course event"}},{color:"#D23369",expr:'@.activity.user.has("course.calendar.addOfficeHours")',id:"activity.user.has.addOfficeHours",label:{badge:"User Activity",description:"Has added course office hours"}},{color:"#D23369",expr:'@.activity.user.has("components.directives.messages.courseConversation.sendMessage.button")',id:"activity.user.has.sendCourseMessage",label:{badge:"User Activity",description:"Has sent a course message"}}])}},dt=n(38084),ht=n(8919);function pt(e){return e.replace(/[\u00A0-\u9999<>&]/g,(function(e){return"&#".concat(e.charCodeAt(0),";")}))}var vt=["option"],ft=["availableConditions","initialConditions","field","onDataChange"],mt=function(e){var t=e.option,n=(0,U.Z)(e,vt);return(0,M.jsx)(dt.Z,(0,E.Z)((0,E.Z)({},n),{},{color:"error",sx:(0,E.Z)((0,E.Z)({},n.sx),{},{backgroundColor:t.color})}))},xt=function(e){var t=e.availableConditions,n=e.initialConditions,r=void 0===n?{}:n,o=e.field,a=e.onDataChange,c=(0,U.Z)(e,ft),l=i.useState(),u=(0,s.Z)(l,2),d=u[0],h=u[1],p=i.useState(""),v=(0,s.Z)(p,2),f=v[0],m=v[1];return i.useEffect((function(){void 0===d&&h(t.filter((function(e){return e.id in r})))}),[t,r,d]),(0,M.jsx)(ht.Z,{filterOptions:function(e,t){var n=e.filter((function(e){var t,n;return null===(t=null===(n=e.applicable)||void 0===n?void 0:n.call(e,{conditions:null!==d&&void 0!==d?d:[]}))||void 0===t||t}));return""===t.inputValue?n:n.filter((function(e){return function(e,t){for(var n=Zt(e),i=0,r=n;i<r.length;i++){var o=r[i];if(!new RegExp(o,"i").test(t))return!1}return!0}(t.inputValue,t.getOptionLabel(e))})).sort((function(e,n){return t.getOptionLabel(e).length-t.getOptionLabel(n).length}))},getOptionLabel:function(e){return"".concat(e.label.badge,": ").concat(e.label.description)},multiple:!0,onChange:function(e,n){var i=n.reduce((function(e,t){var n=t.id;return(0,E.Z)((0,E.Z)({},e),{},(0,Ye.Z)({},n,!0))}),{});h(n);var r=n.length>0?"@.lang.and(".concat(t.filter((function(e){return e.id in i})).map((function(e){return JSON.stringify(e.expr)})).join(","),")"):"";a(i,r)},options:t,renderInput:function(e){var t={checked:!1,multiple:!1,name:o.name,onBlur:o.onBlur,onChange:function(e){return m(e.target.value)},value:f};return(0,M.jsx)(R.n,(0,E.Z)((0,E.Z)((0,E.Z)({},c),e),{},{field:t}))},renderOption:function(e,t,n){return(0,M.jsxs)("li",(0,E.Z)((0,E.Z)({},e),{},{children:[(0,M.jsx)(mt,{label:t.label.badge,option:t,sx:{mr:1}})," ",(0,M.jsx)("span",{dangerouslySetInnerHTML:{__html:gt(n.inputValue,t.label.description)}})]}))},renderTags:function(e,t,n){return(0,M.jsx)(M.Fragment,{children:e.map((function(e,i){var r;return(0,M.jsx)(mt,(0,E.Z)((0,E.Z)({},t({index:i})),{},{label:null===(r=n.getOptionLabel)||void 0===r?void 0:r.call(n,e),option:e}))}))})},value:null!==d&&void 0!==d?d:[]})};function gt(e,t){var n=Zt(pt(e));return pt(t).replaceAll(new RegExp("(".concat(n.join("|"),")"),"gi"),"<strong>$1</strong>")}function Zt(e){return e.split(/\s+/g).map((function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}))}var jt=function(e){var t,n,i,r,o,a=e.attrName,s=e.formik,c=e.site,l=e.tour,u=e.FieldProps,d=void 0===u?{}:u,h=ut[null!==(t=null===(n=c.platform)||void 0===n?void 0:n.id)&&void 0!==t?t:""];return void 0!==(null===h||void 0===h?void 0:h.conditions)?(0,M.jsx)(D.gN,(0,E.Z)((0,E.Z)((0,E.Z)({helperText:"Search to add conditions",label:"Conditions",placeholder:"Begin typing to search...",size:"medium",validate:!0,variant:"outlined"},d.base),d.search),{},{availableConditions:h.conditions,component:xt,initialConditions:null!==(i=null===l||void 0===l||null===(r=l[a])||void 0===r||null===(o=r.data)||void 0===o?void 0:o.conditions)&&void 0!==i?i:[],name:"".concat(a,".jsonpath"),onDataChange:function(e,t){s.setFieldValue("".concat(a,".data"),{conditions:e},!1),s.setFieldValue("".concat(a,".jsonpath"),t,!0)}})):(0,M.jsx)(D.gN,(0,E.Z)((0,E.Z)((0,E.Z)({helperText:"Enter a JSONPath boolean expression",placeholder:'!@.context.user.anonymous && @.context.page.id == "dashboard"',size:"medium",validate:!0,variant:"outlined"},d.base),d.text),{},{component:R.n,name:"".concat(a,".jsonpath")}))},bt=n(71250),yt=n(75012),wt=(0,u.ZP)("div")((function(e){var t=e.theme;return{"&.error .tox":{border:"solid 1px ".concat(t.palette.error.main)}}})),Ct=function(e){var t,n,r=e.errorText,o=e.onBlur,a=e.onChange,c=e.value,l=(0,v.Z)(),u=(0,i.useState)(),d=(0,s.Z)(u,2),h=d[0],p=d[1],f=(0,i.useCallback)((function(){void 0!==h&&a(h.getContent())}),[h,a]);return(0,M.jsxs)(wt,{className:void 0!==r?"error":void 0,children:[(0,M.jsx)(yt.M,{apiKey:"lqdxhe0s1vh85uk1ft713xbc1t39xpqugkonxscjeu9azh4z",init:{branding:!1,content_style:"\n            body { \n              color: ".concat(l.palette.text.primary,";\n              font-family: ").concat(null!==(t=l.typography.fontFamily)&&void 0!==t?t:"sans-serif",";\n              font-weight: ").concat(null!==(n=l.typography.fontWeightRegular)&&void 0!==n?n:"400",";\n              font-size: 1rem;\n              line-height: 1.5;\n            }\n\n            p {\n              margin: 0;\n            }\n          "),init_instance_callback:function(e){return p(e)},max_height:500,menubar:!1,plugins:["autolink","autoresize","code","fullscreen","image","link","lists","table","advlist"],toolbar:"bold italic bullist numlist table image | fullscreen | removeformat code"},onBlur:o,onEditorChange:function(){return f()},onKeyUp:function(){return f()},value:c}),void 0!==r?(0,M.jsx)(bt.Z,{error:!0,children:r}):void 0]})},St=["actionsComponent","children","illustrationComponent"],kt=(0,u.ZP)(h.Z)({alignItems:"center",display:"flex",maxWidth:"35em"}),Pt=(0,u.ZP)(h.Z)((function(e){var t=e.theme;return{"& svg":{height:t.typography.h1.fontSize,opacity:.3,width:t.typography.h1.fontSize},marginRight:t.spacing(2)}})),$t=(0,u.ZP)(h.Z)({alignSelf:"stretch",display:"flex",flexDirection:"column",flexGrow:1}),Et=(0,u.ZP)(h.Z)((function(e){var t=e.theme;return{flexGrow:1,padding:"".concat(t.spacing(2)," 0")}})),It=(0,u.ZP)(h.Z)({alignItems:"center",display:"flex",justifyContent:"flex-end"}),Tt=function(e){var t=e.actionsComponent,n=e.children,i=e.illustrationComponent,r=(0,U.Z)(e,St);return(0,M.jsxs)(kt,(0,E.Z)((0,E.Z)({},r),{},{children:[(0,M.jsx)(Pt,{children:i}),(0,M.jsxs)($t,{children:[(0,M.jsx)(Et,{children:n}),void 0!==t?(0,M.jsx)(It,{children:t}):void 0]})]}))},Ft=["id"],At=(0,u.ZP)(re)((function(e){return{margin:e.theme.spacing(.5)}})),Ot=(0,u.ZP)(fe.Z)((function(e){return{"& > div.MuiAccordionSummary-content":{marginRight:e.theme.spacing(2),minWidth:0}}})),Mt=H.object().shape({type:H.mixed().oneOf(["css","xpath"]).default("css"),value:H.string().when("type",{is:"xpath",otherwise:H.string().validCssSelector(),then:H.string().validXpathSelector()}).default("")}),Nt=H.object().shape({html:H.string().required("Message is required").validNonEmptyHtml({empty:"Message requires some text"}),mask:H.boolean().required(),selector:Mt.notRequired()}),Ut=H.object().shape({data:H.object(),jsonpath:H.string().default("").validJsonPathFilter()}),Dt=H.object().shape({launch:Ut.nullable(!0).optional(),match:Ut,name:H.string().required("Name is required"),status:H.mixed().oneOf(["draft","published"]).default("draft"),steps:H.array().of(Nt)}),Rt=function(e){var t=e.managementService,n=e.onClose,r=void 0===n?function(){}:n,o=e.onExited,a=void 0===o?function(){}:o,c=e.onSave,l=void 0===c?function(){}:c,u=e.open,d=e.site,f=e.tour,m=(0,v.Z)(),x=(0,i.useRef)(null),Z=(0,i.useState)((function(){return qt(f)})),j=(0,s.Z)(Z,2),b=j[0],C=j[1],S=(0,i.useMemo)((function(){var e;return""!==(null!==(e=null===f||void 0===f?void 0:f.id)&&void 0!==e?e:"")}),[f]),k=(0,i.useState)(),P=(0,s.Z)(k,2),$=P[0],I=P[1],T=(0,i.useState)({}),F=(0,s.Z)(T,2),A=F[0],O=F[1];function N(e,t){O((0,Ye.Z)({},e.values.steps.length,!0)),t.push(Ht())}function U(e){I(e),null!==x.current&&x.current.submitForm()}function W(){return z.apply(this,arguments)}function z(){return(z=(0,w.Z)((0,y.Z)().mark((function e(){return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===f){e.next=4;break}return e.next=3,t.deleteTour(d.id,f.id);case 3:r();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,i.useEffect)((function(){C(qt(f)),O({})}),[f]),(0,M.jsx)(ee,{actions:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(V,{onClick:function(){return r()},size:"large",children:"Cancel"}),(0,M.jsx)(V,{onClick:function(){return U("draft")},size:"large",children:S&&"draft"!==(null===b||void 0===b?void 0:b.status)?"Save and unpublish":"Save draft"}),(0,M.jsx)(V,{onClick:function(){return U("published")},size:"large",variant:"contained",children:S?"draft"===(null===b||void 0===b?void 0:b.status)?"Save and publish":"Save":"Publish"})]}),onClose:r,onExited:a,open:u,title:S?"Edit tour":"Create tour",children:(0,M.jsx)(D.J9,{enableReinitialize:!0,initialValues:b,innerRef:x,onSubmit:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(n,i){var r,o,a,s;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.setSubmitting(!0),a=(0,E.Z)((0,E.Z)({},n),{},{status:null!==(r=null!==$&&void 0!==$?$:null===b||void 0===b?void 0:b.status)&&void 0!==r?r:n.status,steps:n.steps.map((function(e){return(0,E.Z)((0,E.Z)({},e),{},{selector:void 0!==e.selector&&""===e.selector.value.trim()?void 0:e.selector})}))}),e.next=4,S?t.updateTour(d.id,null!==(o=null===f||void 0===f?void 0:f.id)&&void 0!==o?o:"",{tour:a}):t.createTour(d.id,{tour:a});case 4:s=e.sent,i.setSubmitting(!1),l(s);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validateOnChange:!1,validationSchema:Dt,children:function(e){var t;return(0,M.jsxs)(D.l0,{children:[(0,M.jsx)(p.Z,{component:"h2",mb:.75,variant:"subtitle1",children:"Profile"}),(0,M.jsx)(D.gN,{component:R.n,fullWidth:!0,helperText:"A human-friendly name, for your eyes only",label:"Tour name",name:"name",placeholder:"New account orientation",size:"medium",validate:!0,variant:"outlined"}),(0,M.jsx)(p.Z,{component:"h2",mb:.75,mt:2.5,variant:"subtitle1",children:"Criteria"}),(0,M.jsx)(h.Z,{my:2,children:(0,M.jsx)(jt,{FieldProps:{base:{fullWidth:!0,label:"Available when..."}},attrName:"match",formik:e,site:d,tour:f})}),(0,M.jsx)(h.Z,{my:2,children:(0,M.jsx)(rt.Z,{control:(0,M.jsx)(ot.Z,{checked:"true"===(null===(t=e.values.launch)||void 0===t?void 0:t.jsonpath),onChange:function(){var t;void 0===(null!==(t=e.values.launch)&&void 0!==t?t:void 0)?e.setFieldValue("launch",{jsonpath:"true"}):e.setFieldValue("launch",null)}}),label:"Automatically launch"})}),(0,M.jsx)(D.F2,{name:"steps",children:function(t){return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(p.Z,{component:"h2",mb:.75,mt:2.5,variant:"subtitle1",children:(0,M.jsxs)(ie,{children:[(0,M.jsx)(re,{grow:!0,children:"Steps"}),(0,M.jsx)(re,{children:(0,M.jsx)(g.Z,{color:"primary",onClick:function(){return N(e,t)},children:(0,M.jsx)(Ke.Z,{})})})]})}),0===e.values.steps.length?(0,M.jsx)(ie,{justifyContent:"center",width:"100%",children:(0,M.jsx)(Tt,{actionsComponent:(0,M.jsx)(V,{color:"primary",onClick:function(){return N(e,t)},variant:"contained",children:"Create Step"}),illustrationComponent:(0,M.jsx)(Qe.Z,{style:{height:m.typography.h2.fontSize,width:m.typography.h2.fontSize}}),mt:2,style:{maxWidth:"30rem"},children:"A tour step is one message in a sequence of interactive message dialogs that are shown to your users when the tour criteria is met."})}):(0,M.jsx)(h.Z,{sx:{width:"100%"},children:e.values.steps.map((function(n,i){var r,o,a;return(0,M.jsxs)(ve.Z,{expanded:null!==(r=A[i])&&void 0!==r&&r,children:[(0,M.jsxs)(Ot,{expandIcon:(0,M.jsx)(le.Z,{}),onClick:function(){return O((function(e){return(0,Ye.Z)({},i,!e[i])}))},children:[(0,M.jsx)(re,{mr:1,width:"2rem",children:(0,M.jsxs)(p.Z,{component:"h3",variant:"body1",children:[i+1,"."]})}),(0,M.jsx)(re,{flex:"1",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:(0,M.jsx)(p.Z,{sx:{display:"inline",opacity:.875},variant:"body2",children:zt(n.html)})}),Wt(e.errors,i)?(0,M.jsx)(re,{color:"error.main",mr:1,sx:{alignItems:"center",display:"flex"},children:(0,M.jsx)(et.Z,{})}):void 0]}),(0,M.jsxs)(me.Z,{children:[(0,M.jsxs)(ie,{justifyContent:"flex-end",children:[(0,M.jsx)(g.Z,{disabled:0===i,onClick:function(){O((function(e){var t;return(0,E.Z)((0,E.Z)({},e),{},(t={},(0,Ye.Z)(t,i-1,e[i]),(0,Ye.Z)(t,i,e[i-1]),t))})),t.swap(i-1,i)},title:"Move up",children:(0,M.jsx)(tt.Z,{})}),(0,M.jsx)(g.Z,{disabled:i===e.values.steps.length-1,onClick:function(){O((function(e){var t;return(0,E.Z)((0,E.Z)({},e),{},(t={},(0,Ye.Z)(t,i+1,e[i]),(0,Ye.Z)(t,i,e[i+1]),t))})),t.swap(i,i+1)},title:"Move down",children:(0,M.jsx)(nt.Z,{})}),(0,M.jsx)(h.Z,{ml:2,children:(0,M.jsx)(V,{color:"inherit",onClick:function(){t.remove(i),O((function(e){return(0,E.Z)((0,E.Z)({},e),{},(0,Ye.Z)({},i,!1))}))},startIcon:(0,M.jsx)(it.Z,{}),children:"Delete"})})]}),(0,M.jsx)(h.Z,{my:2,children:(0,M.jsxs)("label",{children:["Message content:",(0,M.jsx)(Ct,{errorText:e.getFieldMeta("steps[".concat(i,"].html")).error,onBlur:function(){e.setFieldTouched("steps[".concat(i,"].html"),!0)},onChange:function(t){e.setFieldValue("steps[".concat(i,"].html"),t)},value:e.values.steps[i].html})]})}),(0,M.jsx)(h.Z,{my:2,children:(0,M.jsx)(rt.Z,{control:(0,M.jsx)(ot.Z,{checked:e.values.steps[i].mask,onChange:function(){e.setFieldValue("steps[".concat(i,"].mask"),!e.values.steps[i].mask)}}),label:"Darken the screen"})}),(0,M.jsxs)(Je.Z,{direction:"row",my:2,children:[(0,M.jsx)(re,{grow:!0,children:(0,M.jsx)(D.gN,{component:R.n,fullWidth:!0,helperText:"Use the CSS/XPath toggle to choose a selector format",label:"Attach to element",name:"steps[".concat(i,"].selector.value"),size:"medium",variant:"outlined"})}),(0,M.jsx)(At,{children:(0,M.jsxs)(at.Z,{onChange:function(){setTimeout((function(){return e.setFieldTouched("steps[".concat(i,"].selector.value"),!0,!0)}))},value:[null!==(o=null===(a=e.values.steps[i].selector)||void 0===a?void 0:a.type)&&void 0!==o?o:"css"],children:[(0,M.jsx)(st.Z,{onClick:function(){return e.setFieldValue("steps[".concat(i,"].selector.type"),"css")},value:"css",children:"CSS"}),(0,M.jsx)(st.Z,{onClick:function(){return e.setFieldValue("steps[".concat(i,"].selector.type"),"xpath")},value:"xpath",children:"XPath"})]})})]})]})]},i)}))})]})}}),S?(0,M.jsx)(Je.Z,{direction:"row-reverse",my:2,children:(0,M.jsxs)(V,{color:"error",onClick:W,variant:"contained",children:[(0,M.jsx)(it.Z,{})," Delete"]})}):void 0]})}})})};function Wt(e,t){if(void 0===e.steps||"string"===typeof e.steps)return!1;var n=e.steps[t];return void 0!==n&&void 0!==Object.values(n).find((function(e){return void 0!==e}))}function zt(e){try{var t,n,i,r=null!==(t=null===(n=(new DOMParser).parseFromString(e,"text/html"))||void 0===n||null===(i=n.body.textContent)||void 0===i?void 0:i.trim())&&void 0!==t?t:"";return""===r?"No content":r}catch(o){return"No content"}}function qt(e){if(void 0===e)return{match:{jsonpath:""},name:"",status:"draft",steps:[]};e.id;var t,n=(0,U.Z)(e,Ft);return(0,E.Z)((0,E.Z)({},n),{},{match:{jsonpath:null!==(t=e.match.jsonpath)&&void 0!==t?t:""},steps:e.steps.map(Ht)})}function Ht(e){return void 0===e?{html:"",id:"",mask:!1,selector:{type:"css",value:""}}:void 0!==e.selector?e:(0,E.Z)((0,E.Z)({},e),{},{selector:{type:"css",value:""}})}var _t=n(84217),Vt=(0,u.ZP)("input")({display:"none"}),Lt=function(e){var t=e.accept,n=e.ButtonProps,i=e.icon,r=void 0===i?(0,M.jsx)(_t.Z,{}):i,o=e.inputId,a=e.onImport;return(0,M.jsxs)("label",{htmlFor:o,children:[(0,M.jsx)(Vt,{accept:t,id:o,onChange:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t){var n,i,r;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:void 0!==(r=null!==(n=null===(i=t.target.files)||void 0===i?void 0:i.item(0))&&void 0!==n?n:void 0)&&a(r);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),type:"file"}),(0,M.jsx)(g.Z,(0,E.Z)((0,E.Z)({},n),{},{component:"span",children:r}))]})},Jt=(0,u.ZP)(Le.Z)((function(e){return{"&.published":{borderLeftColor:e.theme.palette.success.main},borderLeft:"solid 3px #ccc"}})),Bt=function(e){var t=e.managementService,n=(0,j.UO)().siteId,r=b((function(){return t.sites$.pipe((0,Ge.U)((function(e){return null===e||void 0===e?void 0:e.find((function(e){return e.id===n}))})))}),[t]),o=(0,s.Z)(r,1)[0],a=b((function(){return t.tours$}),[t]),c=(0,s.Z)(a,1)[0],l=(0,i.useState)(!1),u=(0,s.Z)(l,2),d=u[0],p=u[1],v=(0,i.useState)(),f=(0,s.Z)(v,2),m=f[0],x=f[1];return(0,i.useEffect)((function(){void 0!==n&&t.loadTours(n)}),[t,n]),(0,M.jsxs)(M.Fragment,{children:[void 0!==n&&void 0!==c&&c.length>0?(0,M.jsxs)(h.Z,{width:"100%",children:[(0,M.jsxs)(Je.Z,{direction:"row",my:3,spacing:1,children:[(0,M.jsx)(V,{color:"primary",onClick:function(){x(void 0),p(!0)},variant:"contained",children:"Create tour"}),(0,M.jsx)(Lt,{ButtonProps:{title:"Create from template"},inputId:"import-tour",onImport:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t){var n;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E.Z,e.t1=E.Z,e.t2={},e.t3=JSON,e.next=6,t.text();case 6:e.t4=e.sent,e.t5=e.t3.parse.call(e.t3,e.t4),e.t6=(0,e.t1)(e.t2,e.t5),e.t7={},e.t8={id:"",status:"draft"},n=(0,e.t0)(e.t6,e.t7,e.t8),x(n),p(!0);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]}),(0,M.jsx)(ie,{flexWrap:"wrap",m:-1,children:c.map((function(e){return(0,M.jsx)(h.Z,{m:1,width:"23%",children:(0,M.jsx)(Jt,{className:e.status,onClick:function(){x(e),p(!0)},sx:{cursor:"pointer",position:"relative"},children:(0,M.jsx)(Be.Z,{action:(0,M.jsx)(g.Z,{download:"Enactive_".concat(e.name.replace(/\s+/,"_"),".json"),href:"data:application/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(e))),onClick:function(e){return e.stopPropagation()},title:"Download as template",children:(0,M.jsx)(_e.Z,{})}),avatar:(0,M.jsx)(Xe.Z,{sx:{bgcolor:"blue"},children:e.name.split(/\s+/).map((function(e){var t;return null===(t=e[0])||void 0===t?void 0:t.toUpperCase()})).join("")}),subheader:"draft"===e.status?"DRAFT":"PUBLISHED",title:e.name})})},e.id)}))})]}):void 0!==n&&void 0!==c?(0,M.jsx)(Ae,{children:(0,M.jsx)(Tt,{actionsComponent:(0,M.jsxs)(Je.Z,{direction:"row",spacing:2,children:[(0,M.jsx)(V,{onClick:function(){x(void 0),p(!0)},size:"large",variant:"contained",children:"Create tour"}),(0,M.jsx)(Lt,{ButtonProps:{title:"Create from template"},inputId:"import-tour",onImport:function(){var e=(0,w.Z)((0,y.Z)().mark((function e(t){var n;return(0,y.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=E.Z,e.t1=E.Z,e.t2={},e.t3=JSON,e.next=6,t.text();case 6:e.t4=e.sent,e.t5=e.t3.parse.call(e.t3,e.t4),e.t6=(0,e.t1)(e.t2,e.t5),e.t7={},e.t8={id:"",status:"draft"},n=(0,e.t0)(e.t6,e.t7,e.t8),x(n),p(!0);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})]}),illustrationComponent:(0,M.jsx)(Ve.Z,{}),children:"Create your first contextual, interactive experience for your user that is tailored for your product or website."})}):void 0,void 0!==o?(0,M.jsx)(Rt,{managementService:t,onClose:function(){return p(!1)},onSave:function(){return p(!1)},open:d,site:o,tour:m}):void 0]})},Xt=(0,u.ZP)(d.Z)({alignItems:"center",display:"flex",flexDirection:"column",flexGrow:1,width:"100%"}),Gt=(0,u.ZP)(h.Z)({"& > a":{border:"solid 0.3em rgba(0, 0, 0, 0)",borderLeftWidth:0,borderRadius:0,borderRightWidth:0,height:"100%",padding:"0 2em"},"& > a.active":{borderBottomColor:"currentColor"},alignItems:"center",display:"flex",flexGrow:1,height:"100%"}),Yt=(0,u.ZP)(l.Z)((function(e){var t=e.theme;return{height:t.typography.h5.fontSize,marginRight:t.spacing(1),width:t.typography.h5.fontSize}})),Kt=(0,u.ZP)(p.Z)((function(e){return{marginRight:e.theme.spacing(4)}})),Qt=(0,u.ZP)(h.Z)({display:"flex",flexDirection:"column",height:"100vh"}),en=(0,u.ZP)(Qt)({alignItems:"center",justifyContent:"center",width:"100%"}),tn=new $,nn=document.createElement("script");nn.src="https://".concat(window.location.hostname,"/integration/entrypoint.js?_=").concat(Date.now()),nn.setAttribute("enactive.site-id","8c60a02a-3b36-4cf1-874a-bbf0d68f6e29"),nn.setAttribute("enactive.enabled","false"),document.body.appendChild(nn);var rn=function(){var e,t,n=(0,v.Z)(),r=b((function(){return tn.me$}),[]),o=(0,s.Z)(r,1)[0],l=b((function(){return tn.sites$}),[]),u=(0,s.Z)(l,1)[0],d=(0,i.useState)(),p=(0,s.Z)(d,2),y=p[0],w=p[1],C=(null!==(e=null===(t=(0,j.bS)("/sites/:siteId/:viewId"))||void 0===t?void 0:t.params)&&void 0!==e?e:{}).viewId,S=(0,i.useState)(!1),k=(0,s.Z)(S,2),P=k[0],$=k[1],E=(0,i.useMemo)((function(){return null!==o&&void 0!==o&&void 0!==y&&!P||void 0===o&&void 0}),[o,y,P]),I=(0,i.useState)(!1),T=(0,s.Z)(I,2),F=T[0],A=T[1];return(0,i.useEffect)((function(){tn.init()}),[]),(0,i.useEffect)((function(){void 0!==o?(null===o?($(!0),nn.removeAttribute("enactive.context.user.id")):nn.setAttribute("enactive.context.user.id",o.id),-1!==window.location.hostname.indexOf("enactive.ac")&&-1===window.location.hostname.indexOf("local.enactive.ac")&&nn.setAttribute("enactive.enabled","true")):nn.setAttribute("enactive.enabled","false")}),[o]),(0,i.useEffect)((function(){w(void 0!==u?u[0]:void 0)}),[u]),(0,M.jsx)(M.Fragment,{children:void 0!==E?(0,M.jsxs)(Qt,{children:[(0,M.jsx)(f.Z,{position:"static",children:(0,M.jsxs)(m.Z,{children:[(0,M.jsx)(Yt,{}),(0,M.jsx)(Kt,{variant:"h6",children:"Enactive Management"}),(0,M.jsx)(Gt,{children:function(){if(E&&void 0!==y)return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.Z,{className:"tours"===C?"active":void 0,color:"inherit",component:a.rU,to:"/sites/".concat(y.id,"/tours"),children:"Tours"}),(0,M.jsx)(x.Z,{className:"installation"===C?"active":void 0,color:"inherit",component:a.rU,to:"/sites/".concat(y.id,"/installation"),children:"Installation"})]})}()}),E?null!==o&&void 0!==o?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(h.Z,{mr:2,children:(0,M.jsx)(g.Z,{color:"inherit",onClick:function(){return A(!0)},size:"large",title:"Edit theme",children:(0,M.jsx)(c.Z,{})})}),(0,M.jsx)(N,{buttonProps:{sx:{display:"flex",height:"100%"}},me:o,onSignOut:function(){return tn.logout()}})]}):void 0:(0,M.jsx)(x.Z,{color:"inherit",component:a.rU,sx:{display:"flex",height:"100%",paddingX:n.spacing(2)},to:"/signin",children:"Sign In"})]})}),(0,M.jsx)(Xt,{children:(0,M.jsxs)(j.Z5,{children:[(0,M.jsx)(j.AW,{element:E?(0,M.jsx)(j.Fg,{replace:!0,to:"/"}):(0,M.jsx)(qe,{managementService:tn,onSignIn:function(){return $(!1)}}),path:"/signin"}),(0,M.jsx)(j.AW,{element:E&&void 0!==y?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(j.Z5,{children:[(0,M.jsx)(j.AW,{element:(0,M.jsx)(j.Fg,{replace:!0,to:"/sites/".concat(y.id,"/tours")}),path:"/"}),(0,M.jsx)(j.AW,{element:(0,M.jsx)(Bt,{managementService:tn}),path:"/sites/:siteId/tours"}),(0,M.jsx)(j.AW,{element:(0,M.jsx)(Ie,{}),path:"/sites/:siteId/installation"})]}),(0,M.jsx)(ce,{managementService:tn,onClose:function(){return A(!1)},onExited:function(){},onSave:function(){return A(!1)},open:F,site:y})]}):(0,M.jsx)(j.Fg,{replace:!0,to:"/signin"}),path:"/*"})]})})]}):(0,M.jsx)(en,{children:(0,M.jsx)(Z.Z,{})})})},on=function(){return(0,M.jsx)(r.Z,{injectFirst:!0,children:(0,M.jsx)(a.UT,{children:(0,M.jsx)(o.ZP,{children:(0,M.jsx)(rn,{})})})})}}}]);
//# sourceMappingURL=9551.64ac6e83.chunk.js.map