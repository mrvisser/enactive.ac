(this["webpackJsonpenactive-management-ui"]=this["webpackJsonpenactive-management-ui"]||[]).push([[0],{353:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(51),c=n.n(a),s=n(413),o=n(414),u=n(68),l=n(12),d=n(5),h=n(428),j=n(433),b=n(432),v=n(444),p=n(445),x=n(426),m=n(446),f=n(179),O=n.n(f),g=n(21);function y(e,t,n){var i=r.a.useState(n),a=Object(l.a)(i,2),c=a[0],s=a[1],o=r.a.useCallback(e,t);return r.a.useEffect((function(){var e=o();if(void 0!==e){var t=e.subscribe(s);return function(){return t.unsubscribe()}}}),[o]),[c]}var w=n(16),S=n.n(w),C=n(24),k=n(17),$=n(18),E=n(172),I=n.n(E),T=n(416),R=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.a.create({baseURL:"".concat(null!==(t=new URLSearchParams(window.location.search.slice(1)).get("_devHost"))&&void 0!==t?t:"https://api.".concat(window.location.hostname.replace("www.","")),"/api/v1/"),withCredentials:!0});Object(k.a)(this,e),this.axios=n,this.account$$=new T.a(void 0),this.sites$$=new T.a(void 0),this.tours$$=new T.a(void 0),this.account$=this.account$$.asObservable(),this.sites$=this.sites$$.asObservable(),this.tours$=this.tours$$.asObservable()}return Object($.a)(e,[{key:"init",value:function(){var e=Object(C.a)(S.a.mark((function e(){var t,n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.account$$.value,e.next=3,this.getMe().catch((function(){return null}));case 3:if(n=e.sent,(null===t||void 0===t?void 0:t.id)===(null===n||void 0===n?void 0:n.id)){e.next=11;break}if(null!==n){e.next=9;break}this.sites$$.next(void 0),e.next=11;break;case 9:return e.next=11,this.loadSites(n);case 11:this.account$$.next(n);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMe",value:function(){var e=Object(C.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/me");case 2:return e.abrupt("return",e.sent.data.account);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signUp",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var n,i;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/signup",{email:t,id:""});case 2:return n=e.sent,i=n.data,this.account$$.next(i),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(C.a)(S.a.mark((function e(t,n){var i,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/login",{code:n,id:t});case 2:return i=e.sent,r=i.data,this.account$$.next(r),e.next=7,this.loadSites(r);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(C.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/logout");case 2:this.tours$$.next(void 0),this.sites$$.next(void 0),this.account$$.next(void 0),window.location.reload();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadTours",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/sites/".concat(t,"/tours"));case 2:return n=e.sent,this.tours$$.next(n.data.tours),e.abrupt("return",n.data.tours);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTour",value:function(){var e=Object(C.a)(S.a.mark((function e(t,n){var i,r,a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/sites/".concat(t,"/tours"),n);case 2:return i=e.sent,r=i.data.tour,a=this.tours$$.value,this.tours$$.next(void 0===a?[r]:a.concat([r])),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTour",value:function(){var e=Object(C.a)(S.a.mark((function e(t,n,i){var r,a,c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.put("management/sites/".concat(t,"/tours/").concat(n),i);case 2:return r=e.sent,a=r.data.tour,c=this.tours$$.value,this.tours$$.next(void 0===c?[a]:c.map((function(e){return e.id===a.id?a:e}))),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"loadSites",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var n,i,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.get("management/sites");case 2:if(n=e.sent,0!==(i=n.data.sites).length){e.next=9;break}return e.next=7,this.createSite({domain:t.email,id:""});case 7:r=e.sent,i.push(r);case 9:return this.sites$$.next(i),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSite",value:function(){var e=Object(C.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post("management/sites",t);case 2:return n=e.sent,e.abrupt("return",n.data.site);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=n(15),M=n(415),q=n(427),z=n(398),P=n(421),A=n(419),W=n(1),N=function(e){var t=e.account,n=e.buttonProps,i=e.onSignOut,a=r.a.useRef(null),c=r.a.useState(!1),s=Object(l.a)(c,2),o=s[0],u=s[1];return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(x.a,Object(F.a)(Object(F.a)({color:"inherit"},n),{},{onClick:function(e){var t;u(!0),null===n||void 0===n||null===(t=n.onClick)||void 0===t||t.call(n,e)},ref:a,children:t.email})),Object(W.jsx)(M.a,{anchorEl:a.current,disablePortal:!0,open:o,children:Object(W.jsx)(q.a,{children:Object(W.jsx)(z.a,{onClickAway:function(){return u(!1)},children:Object(W.jsx)(P.a,{children:Object(W.jsx)(A.a,{children:Object(W.jsx)(x.a,{onClick:function(){return i()},children:"Sign Out"})})})})})})]})},D=n(403),U=Object(d.a)(h.a)({alignItems:"center",display:"flex",flexGrow:1,justifyContent:"center",width:"100%"}),G=n(434),V=n(23),B=n(62),H=n(47);H.addMethod(H.string,"validRegex",(function(){return this.test("test-valid-regex",(function(e){if(void 0===e)return!0;var t=this.path,n=this.createError;try{return new RegExp(e),!0}catch(i){return n({message:i.message,path:t})}}))})),H.addMethod(H.string,"validCssSelector",(function(){return this.test("test-valid-css-selector",(function(e){if(void 0===e||""===e)return!0;var t=this.path,n=this.createError;try{return document.querySelector(e),!0}catch(i){return n({message:"Invalid CSS selector",path:t})}}))})),H.addMethod(H.string,"validXpathSelector",(function(){return this.test("test-valid-xpath-selector",(function(e){if(void 0===e||""===e)return!0;var t=this.path,n=this.createError;try{return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),!0}catch(i){return n({message:"Invalid XPath selector",path:t})}}))})),H.addMethod(H.string,"validNonEmptyHtml",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.empty,n=void 0===t?"Please enter some text":t,i=e.invalid,r=void 0===i?function(e){return"Invalid HTML".concat(void 0!==e?": ".concat(e.message):"")}:i;return this.test("test-valid-non-empty-html",(function(e){var t=this.path,i=this.createError;if(void 0===e)return i({message:n,path:t});try{var a,c,s;return""!==(null!==(a=null===(c=(new DOMParser).parseFromString(e,"text/html"))||void 0===c||null===(s=c.body.textContent)||void 0===s?void 0:s.trim())&&void 0!==a?a:"")||i({message:n,path:t})}catch(o){return i({message:r(o instanceof Error?o:void 0),path:t})}}))}));var L=H,X=n(65),_=function(e){var t=e.disabled,n=void 0!==t&&t,a=e.key,c=Object(X.a)(e,["disabled","key"]),s=r.a.useMemo((function(){return void 0!==a||n?void 0===a?"disabled":n?"".concat(a,"-disabled"):a:void 0}),[n,a]);return Object(i.createElement)(x.a,Object(F.a)(Object(F.a)({},c),{},{disabled:n,key:s}))},J=L.object().shape({code:L.string().required("A 6-digit code is required").matches(/[0-9]{6}/,{message:"A valid 6-digit code is required"})}),Y=Object(d.a)(j.a)((function(e){return{marginTop:e.theme.spacing(2),textAlign:"right"}})),K=function(e){var t=e.account,n=e.managementService,i=e.onCancel,r=e.onSignIn,a=void 0===r?function(){}:r;return Object(W.jsx)(V.d,{initialValues:{code:""},onSubmit:function(){var e=Object(C.a)(S.a.mark((function e(i,r){var c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t){e.next=7;break}return r.setSubmitting(!0),e.next=4,n.login(t.id,i.code);case 4:c=e.sent,r.setSubmitting(!1),a(c);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validationSchema:J,children:function(e){return Object(W.jsxs)(V.c,{children:[Object(W.jsx)(V.a,{component:B.a,fullWidth:!0,helperText:"Check your email and copy your 6 digit sign-in code into this field.",label:"Sign-in code",name:"code"}),Object(W.jsx)(Y,{children:Object(W.jsxs)(G.a,{children:[Object(W.jsx)(_,{onClick:i,size:"large",children:"Cancel"}),Object(W.jsx)(_,{onClick:function(){return e.submitForm()},size:"large",variant:"contained",children:"Sign In"})]})})]})}})},Q=n(402),Z=L.object().shape({email:L.string().required("Email address is required").email("Invalid email address")}),ee=Object(d.a)(j.a)((function(e){return{marginTop:e.theme.spacing(2),textAlign:"right"}})),te=function(e){var t=e.managementService,n=e.onSignUp;return Object(W.jsx)(V.d,{initialValues:{email:""},onSubmit:function(){var e=Object(C.a)(S.a.mark((function e(i,r){var a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setSubmitting(!0),e.next=3,t.signUp(i.email);case 3:a=e.sent,r.setSubmitting(!1),n(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validationSchema:Z,children:function(e){return Object(W.jsxs)(V.c,{children:[Object(W.jsx)(V.a,{component:B.a,fullWidth:!0,helperText:"We'll send you a sign-in code to this email address.",label:"Email address",name:"email"}),Object(W.jsx)(ee,{children:Object(W.jsx)(G.a,{children:Object(W.jsx)(_,{endIcon:Object(W.jsx)(Q.a,{}),onClick:function(){return e.submitForm()},size:"large",variant:"contained",children:"Next"})})})]})}})},ne=function(e){var t=e.managementService,n=e.onSignIn,i=r.a.useState(!1),a=Object(l.a)(i,2),c=a[0],s=a[1],o=r.a.useState(),u=Object(l.a)(o,2),d=u[0],h=u[1],b=y((function(){return t.sites$}),[t]),v=Object(l.a)(b,1)[0];return Object(W.jsxs)(U,{children:[Object(W.jsx)(D.a,{direction:c?"right":"left",in:void 0===d,onEntered:function(){s(!0),ie()},unmountOnExit:!0,children:Object(W.jsx)(j.a,{position:"absolute",width:1/4,children:Object(W.jsx)(te,{managementService:t,onSignUp:h})})}),Object(W.jsx)(D.a,{direction:void 0===v?"left":"right",in:void 0!==d&&void 0===v,onEntered:function(){return ie()},onExited:function(){void 0!==d&&void 0!==v&&n()},unmountOnExit:!0,children:Object(W.jsx)(j.a,{position:"absolute",width:1/4,children:Object(W.jsx)(K,{account:d,managementService:t,onCancel:function(){return h(void 0)}})})})]})};function ie(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"input[name]";null===(e=document.querySelector(n))||void 0===e||null===(t=e.focus)||void 0===t||t.call(e)}var re=n(442),ae=n(443),ce=n(425),se=n(412),oe=n(3),ue=n(439),le=n(29),de=n(438),he=n(420),je=n(440),be=n(431),ve=n(430),pe=n(424),xe=n(441),me=n(405),fe=n(406),Oe=n(407),ge=n(408),ye=n(409),we=n(410),Se=n(411),Ce=n(423),ke=n(435),$e=n(436),Ee=n(437),Ie=n(404),Te=Object(d.a)(Ce.a)((function(e){return{alignItems:"center",display:"flex",justifyContent:"space-between",marginBottom:e.theme.spacing(4)}})),Re=Object(d.a)(ke.a)({padding:"3em"}),Fe=Object(d.a)($e.a)((function(e){var t=e.theme;return{backgroundColor:t.palette.grey[50],borderTop:"solid 1px",borderTopColor:t.palette.grey[200],padding:t.spacing(4)}})),Me=function(e){var t=e.actions,n=e.children,i=e.onClose,r=e.onExited,a=e.open,c=e.title,s=e.width,o=void 0===s?"35rem":s;return Object(W.jsxs)(Ee.a,{anchor:"right",open:a,onClose:i,SlideProps:{onExited:r},children:[Object(W.jsxs)(Te,{children:[Object(W.jsx)(b.a,{component:"span",variant:"h5",style:{flexGrow:1},children:c}),void 0!==i?Object(W.jsx)(de.a,{onClick:i,children:Object(W.jsx)(Ie.a,{})}):void 0]}),Object(W.jsx)(Re,{sx:{width:o},children:n}),Object(W.jsx)(Fe,{children:t})]})},qe=Object(d.a)(j.a)({alignItems:"center",display:"flex",maxWidth:"35em"}),ze=Object(d.a)(j.a)((function(e){e.fontSize;var t=e.theme;return{"& svg":{height:t.typography.h1.fontSize,opacity:.3,width:t.typography.h1.fontSize},marginRight:t.spacing(2)}})),Pe=Object(d.a)(j.a)({alignSelf:"stretch",display:"flex",flexDirection:"column",flexGrow:1}),Ae=Object(d.a)(j.a)((function(e){var t=e.theme;return{flexGrow:1,padding:"".concat(t.spacing(2)," 0")}})),We=Object(d.a)(j.a)({alignItems:"center",display:"flex",justifyContent:"flex-end"}),Ne=function(e){var t=e.actionsComponent,n=e.children,i=e.illustrationComponent,r=Object(X.a)(e,["actionsComponent","children","illustrationComponent"]);return Object(W.jsxs)(qe,Object(F.a)(Object(F.a)({},r),{},{children:[Object(W.jsx)(ze,{children:i}),Object(W.jsxs)(Pe,{children:[Object(W.jsx)(Ae,{children:n}),void 0!==t?Object(W.jsx)(We,{children:t}):void 0]})]}))},De=function(e){var t=e.alignItems,n=void 0===t?"center":t,i=e.col,r=void 0!==i&&i,a=Object(X.a)(e,["alignItems","col"]);return Object(W.jsx)(j.a,Object(F.a)(Object(F.a)({},a),{},{alignItems:n,sx:Object(F.a)(Object(F.a)({},a.sx),{},{display:"flex",flexDirection:r?"column":"row"})}))},Ue=function(e){var t=e.grow,n=void 0!==t&&t,i=Object(X.a)(e,["grow"]);return Object(W.jsx)(j.a,Object(F.a)(Object(F.a)({},i),{},{sx:Object(F.a)(Object(F.a)({},i.sx),{},{flexGrow:n?1:void 0})}))},Ge=n(429),Ve=n(178),Be=n.n(Ve),He=Object(d.a)("div")((function(e){var t=e.theme;return{"& > .quill.error":{border:"solid 1px ".concat(t.palette.error.main)}}})),Le=function(e){var t=e.errorText,n=e.onBlur,i=e.onChange,r=e.value;return Object(W.jsxs)(He,{children:[Object(W.jsx)(Be.a,{className:void 0!==t?"error":void 0,onBlur:n,onChange:i,value:r}),void 0!==t?Object(W.jsx)(Ge.a,{error:!0,children:t}):void 0]})},Xe=Object(d.a)(Ue)((function(e){return{margin:e.theme.spacing(.5)}})),_e=Object(d.a)(ue.a)((function(e){return{"& > div.MuiAccordionSummary-content":{marginRight:e.theme.spacing(2),minWidth:0}}})),Je=L.object().shape({type:L.mixed().oneOf(["css","xpath"]).default("css"),value:L.string().when("type",{is:"xpath",otherwise:L.string().validCssSelector(),then:L.string().validXpathSelector()}).default("")}),Ye=L.object().shape({html:L.string().required("Message is required").validNonEmptyHtml({empty:"Message requires some text"}),mask:L.boolean().required(),selector:Je.notRequired()}),Ke=L.object().shape({match:L.object().shape({regex:L.string().required("URL match expression is required").validRegex()}),name:L.string().required("Name is required"),status:L.mixed().oneOf(["draft","published"]).default("draft"),steps:L.array().of(Ye)}),Qe=function(e){var t=e.managementService,n=e.onClose,i=void 0===n?function(){}:n,a=e.onExited,c=void 0===a?function(){}:a,s=e.onSave,o=void 0===s?function(){}:s,u=e.open,d=e.siteId,h=e.tour,v=Object(le.a)(),p=r.a.useRef(null),x=r.a.useState((function(){return tt(h)})),m=Object(l.a)(x,2),f=m[0],O=m[1],g=r.a.useState(),y=Object(l.a)(g,2),w=y[0],k=y[1],$=r.a.useState({}),E=Object(l.a)($,2),I=E[0],T=E[1];function R(e,t){T(Object(oe.a)({},e.values.steps.length,!0)),t.push(nt())}function M(e){k(e),null!==p.current&&p.current.submitForm()}return r.a.useEffect((function(){O(tt(h)),T({})}),[h]),Object(W.jsx)(Me,{actions:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(_,{onClick:function(){return i()},size:"large",children:"Cancel"}),Object(W.jsx)(_,{onClick:function(){return M("draft")},size:"large",children:""===(null===f||void 0===f?void 0:f.id)||"draft"===(null===f||void 0===f?void 0:f.status)?"Save draft":"Save and unpublish"}),Object(W.jsx)(_,{onClick:function(){return M("published")},size:"large",variant:"contained",children:""===(null===f||void 0===f?void 0:f.id)?"Publish":"draft"===(null===f||void 0===f?void 0:f.status)?"Save and publish":"Save"})]}),onClose:i,onExited:c,open:u,title:""===(null===f||void 0===f?void 0:f.id)?"Create tour":"Edit tour",children:Object(W.jsx)(V.d,{initialValues:f,innerRef:p,onSubmit:function(){var e=Object(C.a)(S.a.mark((function e(n,i){var r,a,c;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.setSubmitting(!0),a=Object(F.a)(Object(F.a)({},n),{},{status:null!==(r=null!==w&&void 0!==w?w:null===f||void 0===f?void 0:f.status)&&void 0!==r?r:n.status,steps:n.steps.map((function(e){return Object(F.a)(Object(F.a)({},e),{},{selector:void 0!==e.selector&&""===e.selector.value.trim()?void 0:e.selector})}))}),e.next=4,""===a.id?t.createTour(d,a):t.updateTour(d,a.id,a);case 4:c=e.sent,i.setSubmitting(!1),o(c);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),validateOnChange:!1,validationSchema:Ke,children:function(e){return Object(W.jsxs)(V.c,{children:[Object(W.jsx)(b.a,{mb:.75,component:"h2",variant:"subtitle1",children:"Profile"}),Object(W.jsx)(V.a,{component:B.a,fullWidth:!0,label:"Name",name:"name",placeholder:"New account orientation",size:"medium",validate:!0,variant:"outlined"}),Object(W.jsx)(b.a,{mb:.75,mt:2.5,component:"h2",variant:"subtitle1",children:"Criteria"}),Object(W.jsx)(V.a,{component:B.a,fullWidth:!0,helperText:"Enter a valid regular expression",label:"URL match expression",name:"match.regex",placeholder:"/dashboard/?",size:"medium",validate:!0,variant:"outlined"}),Object(W.jsx)(V.b,{name:"steps",children:function(t){return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(b.a,{mb:.75,mt:2.5,component:"h2",variant:"subtitle1",children:Object(W.jsxs)(De,{children:[Object(W.jsx)(Ue,{grow:!0,children:"Steps"}),Object(W.jsx)(Ue,{children:Object(W.jsx)(de.a,{color:"primary",onClick:function(){return R(e,t)},children:Object(W.jsx)(me.a,{})})})]})}),0===e.values.steps.length?Object(W.jsx)(De,{justifyContent:"center",width:"100%",children:Object(W.jsx)(Ne,{actionsComponent:Object(W.jsx)(_,{color:"primary",onClick:function(){return R(e,t)},variant:"contained",children:"Create Step"}),illustrationComponent:Object(W.jsx)(fe.a,{style:{height:v.typography.h2.fontSize,width:v.typography.h2.fontSize}}),mt:2,style:{maxWidth:"30rem"},children:"A tour step is one message in a sequence of interactive message dialogs that are shown to your users when the tour criteria is met."})}):Object(W.jsx)(j.a,{sx:{width:"100%"},children:e.values.steps.map((function(n,i){var r,a,c;return Object(W.jsxs)(he.a,{expanded:null!==(r=I[i])&&void 0!==r&&r,children:[Object(W.jsxs)(_e,{expandIcon:Object(W.jsx)(Oe.a,{}),onClick:function(){return T((function(e){return Object(oe.a)({},i,!e[i])}))},children:[Object(W.jsx)(Ue,{width:"2rem",mr:1,children:Object(W.jsxs)(b.a,{variant:"body1",component:"h3",children:[i+1,"."]})}),Object(W.jsx)(Ue,{flex:"1",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:Object(W.jsx)(b.a,{variant:"body2",sx:{display:"inline",opacity:.875},children:et(n.html)})}),Ze(e.errors,i)?Object(W.jsx)(Ue,{color:"error.main",mr:1,sx:{alignItems:"center",display:"flex"},children:Object(W.jsx)(ge.a,{})}):void 0]}),Object(W.jsxs)(je.a,{children:[Object(W.jsxs)(De,{justifyContent:"flex-end",children:[Object(W.jsx)(de.a,{disabled:0===i,onClick:function(){T((function(e){var t;return Object(F.a)(Object(F.a)({},e),{},(t={},Object(oe.a)(t,i-1,e[i]),Object(oe.a)(t,i,e[i-1]),t))})),t.swap(i-1,i)},title:"Move up",children:Object(W.jsx)(ye.a,{})}),Object(W.jsx)(de.a,{disabled:i===e.values.steps.length-1,onClick:function(){T((function(e){var t;return Object(F.a)(Object(F.a)({},e),{},(t={},Object(oe.a)(t,i+1,e[i]),Object(oe.a)(t,i,e[i+1]),t))})),t.swap(i,i+1)},title:"Move down",children:Object(W.jsx)(we.a,{})}),Object(W.jsx)(j.a,{ml:2,children:Object(W.jsx)(_,{color:"inherit",onClick:function(){t.remove(i),T((function(e){return Object(F.a)(Object(F.a)({},e),{},Object(oe.a)({},i,!1))}))},startIcon:Object(W.jsx)(Se.a,{}),children:"Delete"})})]}),Object(W.jsx)(j.a,{my:2,children:Object(W.jsx)(Le,{errorText:e.getFieldMeta("steps[".concat(i,"].html")).error,onBlur:function(){e.setFieldTouched("steps[".concat(i,"].html"),!0)},onChange:function(t){e.setFieldValue("steps[".concat(i,"].html"),t)},value:e.values.steps[i].html})}),Object(W.jsx)(j.a,{my:2,children:Object(W.jsx)(be.a,{control:Object(W.jsx)(ve.a,{checked:e.values.steps[i].mask,onChange:function(){e.setFieldValue("steps[".concat(i,"].mask"),!e.values.steps[i].mask)}}),label:"Highlight the message"})}),Object(W.jsxs)(De,{alignItems:"flex-start",my:2,children:[Object(W.jsx)(Ue,{grow:!0,children:Object(W.jsx)(V.a,{component:B.a,fullWidth:!0,helperText:"Use the CSS/XPath toggle to choose a selector format",label:"Highlight element",name:"steps[".concat(i,"].selector.value"),size:"medium",variant:"outlined"})}),Object(W.jsx)(Xe,{children:Object(W.jsxs)(pe.a,{onChange:function(){setTimeout((function(){return e.setFieldTouched("steps[".concat(i,"].selector.value"),!0,!0)}))},value:[null!==(a=null===(c=e.values.steps[i].selector)||void 0===c?void 0:c.type)&&void 0!==a?a:"css"],children:[Object(W.jsx)(xe.a,{onClick:function(){return e.setFieldValue("steps[".concat(i,"].selector.type"),"css")},value:"css",children:"CSS"}),Object(W.jsx)(xe.a,{onClick:function(){return e.setFieldValue("steps[".concat(i,"].selector.type"),"xpath")},value:"xpath",children:"XPath"})]})})]})]})]},i)}))})]})}})]})}})})};function Ze(e,t){if(void 0===e.steps||"string"===typeof e.steps)return!1;var n=e.steps[t];return void 0!==n&&void 0!==Object.values(n).find((function(e){return void 0!==e}))}function et(e){try{var t,n,i,r=null!==(t=null===(n=(new DOMParser).parseFromString(e,"text/html"))||void 0===n||null===(i=n.body.textContent)||void 0===i?void 0:i.trim())&&void 0!==t?t:"";return""===r?"No content":r}catch(a){return"No content"}}function tt(e){return void 0===e?{id:"",match:{regex:""},name:"",status:"draft",steps:[]}:Object(F.a)(Object(F.a)({},e),{},{steps:e.steps.map(nt)})}function nt(e){return void 0===e?{html:"",id:"",mask:!1,selector:{type:"css",value:""}}:void 0!==e.selector?e:Object(F.a)(Object(F.a)({},e),{},{selector:{type:"css",value:""}})}var it=Object(d.a)(re.a)((function(e){var t=e.theme;return{"&.published:before":{backgroundColor:t.palette.success.main,boxShadow:"0px 0px 5px 1px ".concat(t.palette.success.main)},"&:before":{backgroundColor:t.palette.grey[300],borderRadius:t.spacing(1.5),content:'" "',height:t.spacing(1.5),position:"absolute",right:t.spacing(1),top:t.spacing(1),width:t.spacing(1.5)}}})),rt=function(e){var t=e.managementService,n=Object(g.g)().siteId,i=y((function(){return t.tours$}),[t]),a=Object(l.a)(i,1)[0],c=r.a.useState(!1),s=Object(l.a)(c,2),o=s[0],u=s[1],d=r.a.useState(),h=Object(l.a)(d,2),b=h[0],v=h[1];return r.a.useEffect((function(){t.loadTours(n)}),[t,n]),Object(W.jsxs)(W.Fragment,{children:[void 0!==a&&a.length>0?Object(W.jsxs)(j.a,{width:"100%",children:[Object(W.jsx)(j.a,{my:3,children:Object(W.jsx)(_,{color:"primary",onClick:function(){v(void 0),u(!0)},variant:"contained",children:"Create tour"})}),Object(W.jsx)(De,{flexWrap:"wrap",m:-1,children:a.map((function(e){return Object(W.jsx)(j.a,{m:1,width:"23%",children:Object(W.jsx)(it,{className:e.status,onClick:function(){v(e),u(!0)},sx:{cursor:"pointer",position:"relative"},children:Object(W.jsx)(ae.a,{avatar:Object(W.jsx)(ce.a,{sx:{bgcolor:"blue"},children:e.name.split(/\s+/).map((function(e){var t;return null===(t=e[0])||void 0===t?void 0:t.toUpperCase()})).join("")}),title:e.name})})},e.id)}))})]}):void 0!==a?Object(W.jsx)(U,{children:Object(W.jsx)(Ne,{actionsComponent:Object(W.jsx)(_,{onClick:function(){v(void 0),u(!0)},size:"large",variant:"contained",children:"Create tour"}),illustrationComponent:Object(W.jsx)(se.a,{}),children:"Create your first contextual, interactive experience for your user that is tailored for your product or website."})}):void 0,Object(W.jsx)(Qe,{managementService:t,onClose:function(){return u(!1)},onSave:function(){return u(!1)},open:o,siteId:n,tour:b})]})},at=Object(d.a)(h.a)({alignItems:"center",display:"flex",flexDirection:"column",flexGrow:1,width:"100%"}),ct=Object(d.a)(j.a)({"& > a":{border:"solid 0.3em rgba(0, 0, 0, 0)",borderLeftWidth:0,borderRadius:0,borderRightWidth:0,height:"100%",padding:"0 2em"},"& > a.active":{borderBottomColor:"currentColor"},alignItems:"center",display:"flex",flexGrow:1,height:"100%"}),st=Object(d.a)(O.a)((function(e){var t=e.theme;return{height:t.typography.h5.fontSize,marginRight:t.spacing(1),width:t.typography.h5.fontSize}})),ot=Object(d.a)(b.a)((function(e){return{marginRight:e.theme.spacing(4)}})),ut=Object(d.a)(j.a)({display:"flex",flexDirection:"column",height:"100vh"}),lt=Object(d.a)(ut)({alignItems:"center",justifyContent:"center",width:"100%"}),dt=new R,ht=document.createElement("script");ht.src="https://".concat(window.location.hostname,"/integration/entrypoint.js?_=").concat(Date.now()),ht.setAttribute("enactive.site-id","007b9009-5f1b-4e70-9c68-165c60003798"),ht.setAttribute("enactive.enabled","false"),document.body.appendChild(ht);var jt=function(){var e=y((function(){return dt.account$}),[]),t=Object(l.a)(e,1)[0],n=y((function(){return dt.sites$}),[]),i=Object(l.a)(n,1)[0],a=r.a.useState(),c=Object(l.a)(a,2),s=c[0],o=c[1],d=Object(g.h)("/sites/:siteId/tours"),h=r.a.useState(!1),j=Object(l.a)(h,2),b=j[0],f=j[1],O=r.a.useMemo((function(){return null!==t&&void 0!==t&&void 0!==s&&!b||void 0===t&&void 0}),[t,s,b]);return r.a.useEffect((function(){dt.init()}),[]),r.a.useEffect((function(){void 0!==t?(null===t?(f(!0),ht.removeAttribute("enactive.context.user.id")):ht.setAttribute("enactive.context.user.id",t.id),ht.setAttribute("enactive.enabled","true")):ht.setAttribute("enactive.enabled","false")}),[t]),r.a.useEffect((function(){o(void 0!==i?i[0]:void 0)}),[i]),Object(W.jsx)(W.Fragment,{children:void 0!==O?Object(W.jsxs)(ut,{children:[Object(W.jsx)(v.a,{position:"static",children:Object(W.jsxs)(p.a,{children:[Object(W.jsx)(st,{}),Object(W.jsx)(ot,{variant:"h6",children:"Enactive Management"}),Object(W.jsx)(ct,{children:function(){if(O&&void 0!==s)return Object(W.jsx)(x.a,{className:null!==d?"active":void 0,color:"inherit",component:u.b,to:"/sites/".concat(s.id,"/tours"),children:"Tours"})}()}),O?null!==t&&void 0!==t?Object(W.jsx)(N,{account:t,onSignOut:function(){return dt.logout()}}):void 0:Object(W.jsx)(x.a,{color:"inherit",component:u.b,to:"/signin",children:"Sign In"})]})}),Object(W.jsx)(at,{children:Object(W.jsxs)(g.d,{children:[Object(W.jsx)(g.b,{exact:!0,path:"/signin",children:O?Object(W.jsx)(g.a,{to:"/"}):Object(W.jsx)(ne,{managementService:dt,onSignIn:function(){return f(!1)}})}),Object(W.jsx)(g.b,{path:"/",children:O&&void 0!==s?Object(W.jsxs)(g.d,{children:[Object(W.jsx)(g.b,{exact:!0,path:"/",children:Object(W.jsx)(g.a,{to:"/sites/".concat(s.id,"/tours")})}),Object(W.jsx)(g.b,{exact:!0,path:"/sites/:siteId/tours",children:Object(W.jsx)(rt,{managementService:dt})})]}):Object(W.jsx)(g.a,{to:"/signin"})})]})})]}):Object(W.jsx)(lt,{children:Object(W.jsx)(m.a,{})})})},bt=function(){return Object(W.jsx)(s.a,{injectFirst:!0,children:Object(W.jsx)(u.a,{children:Object(W.jsx)(o.a,{children:Object(W.jsx)(jt,{})})})})};n(351),n(352);c.a.render(Object(W.jsx)(r.a.StrictMode,{children:Object(W.jsx)(bt,{})}),document.getElementById("root"))}},[[353,1,2]]]);
//# sourceMappingURL=main.7d937b03.chunk.js.map